<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>AdminLTE | Edit user</title>
        <%- include('partials/head') %>

        <style>
      .edit-profile-card {
        max-width: 700px;
        margin: 50px auto;
      }

      label.error {
        color: red;
        font-size: 14px;
        margin-top: -8px;
        display: block;
      }

      .profile-image-wrapper {
        position: relative;
        display: inline-block;
      }

      .profile-image-wrapper img {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border-radius: 50%;
        border: 3px solid #007bff;
      }

      .profile-image-wrapper label {
        position: absolute;
        bottom: 0;
        right: 0;
        background-color: #007bff;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border: 2px solid #fff;
      }

      .profile-image-wrapper input[type="file"] {
        display: none;
      }
    </style>
    </head>

    <body class="hold-transition sidebar-mini layout-fixed">
        <div class="wrapper">

            <%- include('partials/sidebar', { name: name, csrfToken: typeof
            csrfToken !== 'undefined' ? csrfToken : null,
            currentPage: currentPage
            }) %>

            <div class="content-wrapper">
                <section class="content-header">
                    <div class="container-fluid">
                        <div class="row mb-2">
                            <div class="col-sm-6">
                                <h1>Profile</h1>
                            </div>
                            <div class="col-sm-6">
                                <ol class="breadcrumb float-sm-right">
                                    <li class="breadcrumb-item"><a
                                            href="#">Home</a></li>
                                    <li class="breadcrumb-item active">User
                                        Profile</li>
                                </ol>
                            </div>
                        </div>
                    </div><!-- /.container-fluid -->
                </section>
                <section class="content">
                    <!-- <div class="container-fluid">
                        <div class="row"> -->

                    <!-- Profile Card (Left) 
                            <div class="col-md-3">
                                <div class="card card-primary card-outline">
                                    <div class="card-body box-profile">

                                        <div class="text-center">
                                            <img
                                                class="profile-user-img img-fluid img-circle"
                                                src="<%= editImage %>"
                                                alt="User profile picture"
                                                style="height: 100px; width: 100px; object-fit: cover;">
                                        </div>
                                        <h3
                                            class="profile-username text-center"><%=
                                            editName %></h3>
                                        <p
                                            class="text-muted text-center"><%=
                                            editUsername %></p>
                                        <ul
                                            class="list-group list-group-unbordered mb-3">
                                            <li class="list-group-item">
                                                <b>Followers</b> <a
                                                    class="float-right">1,322</a>
                                            </li>
                                            <li class="list-group-item">
                                                <b>Following</b> <a
                                                    class="float-right">543</a>
                                            </li>
                                            <li class="list-group-item">
                                                <b>Friends</b> <a
                                                    class="float-right">13,287</a>
                                            </li>
                                        </ul>
                                        <a href="#"
                                            class="btn btn-primary btn-block"><b>Follow</b></a>
                                    </div>
                                </div>
                            </div>-->

                    <!-- Profile Edit Form (Right) -->

                    <div class="card">
                        <div class="card-body">

                            <% if (error) { %>
                            <div id="errorMsg"
                                class="alert alert-danger">
                                <%= error %>
                            </div>
                            <% } %>

                            <form action="/edituser"
                                method="POST"
                                enctype="multipart/form-data"
                                id="editProfileForm" novalidate>

                                <input type="hidden" name="id"
                                    value="<%= editId %>">

                                <div class="text-center mb-4">
                                    <div
                                        class="profile-image-wrapper">
                                        <img src="<%= editImage %>"
                                            alt="User Avatar"
                                            id="previewImg" />
                                        <label for="imageUpload">
                                            <i
                                                class="fas fa-camera text-white"></i>
                                        </label>
                                        <input type="file"
                                            id="imageUpload"
                                            name="image"
                                            accept="image/*" />
                                    </div>
                                </div>

                                <!-- Name -->
                                <div class="form-group">
                                    <label for="name">Full Name</label>
                                    <input type="text"
                                        class="form-control"
                                        name="name"
                                        id="name"
                                        placeholder="Full Name"
                                        value="<%= editName %>"
                                        required />
                                </div>

                                <!-- Email & Phone -->
                                <div class="form-row">
                                    <div
                                        class="form-group col-md-6">
                                        <label for="email">Email</label>
                                        <input type="email"
                                            class="form-control"
                                            name="email"
                                            id="email"
                                            placeholder="Email"
                                            value="<%= editEmail %>"
                                            required />
                                    </div>
                                    <div
                                        class="form-group col-md-6">
                                        <label>Phone Number</label>
                                        <input type="text"
                                            class="form-control"
                                            name="phone"
                                            placeholder="Phone Number"
                                            value="<%= editPhone %>" />
                                    </div>
                                </div>

                                <!-- Username -->
                                <div class="form-group">
                                    <label for="username">Username</label>
                                    <input type="text"
                                        class="form-control"
                                        name="username"
                                        id="username"
                                        placeholder="Username"
                                        value="<%= editUsername %>"
                                        required />
                                </div>

                                <!-- Address -->
                                <div class="form-group">
                                    <label>Address</label>
                                    <textarea name="address"
                                        class="form-control"
                                        placeholder="Address"><%= editAddress %></textarea>
                                </div>

                                <!-- DOB & Gender -->
                                <div class="form-row">
                                    <div
                                        class="form-group col-md-6">
                                        <label>Date of Birth</label>
                                        <input type="date"
                                            value="<%= editDob %>"
                                            class="form-control"
                                            name="dob"
                                            placeholder="Date of Birth" />
                                    </div>
                                    <div
                                        class="form-group col-md-6">
                                        <label>Gender</label><br />
                                        <div
                                            class="form-check form-check-inline">
                                            <input
                                                class="form-check-input"
                                                type="radio"
                                                name="gender"
                                                value="Male"
                                                <%=editGender ===
                                                'Male'
                                                ? 'checked' : '' %>
                                            checked />
                                            <label
                                                class="form-check-label">Male</label>
                                        </div>
                                        <div
                                            class="form-check form-check-inline">
                                            <input
                                                class="form-check-input"
                                                type="radio"
                                                name="gender"
                                                value="Female"
                                                <%=editGender ===
                                                'Female' ? 'checked'
                                                : '' %> />
                                            <label
                                                class="form-check-label">Female</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Hobby -->
                                <div class="form-group">
                                    <label>Hobby</label><br />
                                    <% const hobbiesList = [
                                    "Singing", "Dancing",
                                    "Travelling", "Drawing",
                                    "Gym","Hike",
                                    "Gaming", "Sports", "Coding",
                                    "Other"
                                    ]; %>

                                    <% hobbiesList.forEach(h => { %>
                                    <div
                                        class="form-check form-check-inline">
                                        <input
                                            class="form-check-input"
                                            type="checkbox"
                                            name="hobby"
                                            value="<%= h %>"
                                            <%=Array.isArray(editHobby)
                                            && editHobby.includes(h)
                                            ?
                                            "checked" : "" %>
                                        />
                                        <label
                                            class="form-check-label"><%=
                                            h %></label>
                                    </div>
                                    <% }); %>
                                </div>

                                <!-- Submit -->
                                <div
                                    class="form-group text-center mt-4">
                                    <button type="submit"
                                        class="btn btn-success btn-lg w-100">Save
                                        Changes</button>
                                </div>
                            </form>

                            <div class="text-center mt-2">
                                <a href="/index"
                                    class="text-muted">← Back to
                                    Home</a>
                            </div>
                        </div>
                    </div>

                    <!-- </div>
                    </div> -->
                </section>
            </div>
        </div>

        <%- include('partials/scripts') %>

        <!-- JS to preview selected image -->
        <script>
      document.getElementById("imageUpload").addEventListener("change", function (e) {
        const img = document.getElementById("previewImg");
        if (e.target.files && e.target.files[0]) {
          img.src = URL.createObjectURL(e.target.files[0]);
        }
      });

//for error msg fade
       document.addEventListener("DOMContentLoaded", function() {
    const errorDiv = document.getElementById("errorMsg");
    if (errorDiv) {
      setTimeout(() => {
        errorDiv.style.transition = "opacity 0.5s ease";
        errorDiv.style.opacity = "0";
        setTimeout(() => {
          errorDiv.style.display = "none";
        }, 500);
      }, 5000); 
    }
  });

   $(function() {
  // Define the fields you want to target
  var requiredFields = ["name", "email", "username"];

  requiredFields.forEach(function(fieldName) {
    var $field = $("#editProfileForm").find("[name='" + fieldName + "']");
    var id = $field.attr("id");

    if (id) {
      // Create the asterisk span
      var $asterisk = $('<span class="required-star" style="color:red; margin-left:3px">*</span>');

      // Append it to the label
      $("label[for='" + id + "']").append($asterisk);

      // Show or hide based on initial value
      if ($field.val().trim() !== "") {
        $asterisk.hide();
      }

      // Listen to input changes
      $field.on("input change", function() {
        if ($field.val().trim() === "") {
          $asterisk.fadeIn();
        } else {
          $asterisk.fadeOut();
        }
      });
    }
  });
});

    </script>
    </body>
</html>
