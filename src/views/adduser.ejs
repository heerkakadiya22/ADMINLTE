<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AdminLTE | Add User</title>
    <%- include('partials/head') %>

    <!-- FontAwesome -->
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Styles -->
    <style>
    .edit-profile-card { max-width: 700px; margin: 50px auto; }
    label.error {
  color: red;
  font-size: 14px;
  margin-top: 4px;
  margin-bottom: 6px;
  display: block;
}
    .profile-image-wrapper {
      position: relative;
      display: inline-block;
    }
    .profile-image-wrapper img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 50%;
      border: 3px solid #007bff;
    }
    .profile-image-wrapper label {
      position: absolute;
      bottom: 0;
      right: 0;
      background-color: #007bff;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: 2px solid #fff;
    }
    .profile-image-wrapper input[type="file"] { display: none; }
   </style>
  </head>

  <body class="hold-transition sidebar-mini layout-fixed">
    <div class="wrapper">

      <%- include('partials/sidebar', { name: name, csrfToken: csrfToken
      || '',
      currentPage: currentPage }) %>

      <div class="content-wrapper">
        <%- include('partials/contentHeader', { pageTitle: pageTitle,
        breadcrumbs: breadcrumbs }) %>

        <section class="content">
          <div class="container-fluid">
            <div class="row justify-content-center">

              <div class="card" style="width: 102%;">
                <div class="card-body">

                  <% if (error) { %>
                  <div id="errorMsg"
                    class="alert alert-danger">
                    <%= error %>
                  </div>
                  <% } %>

                  <form action="/adduser" method="POST"
                    enctype="multipart/form-data"
                    id="adduser">
                    <div class="text-center mb-4">
                      <div
                        class="profile-image-wrapper">
                        <img
                          src="/src/assets/image/uploads/profile-user.png"
                          alt="User Avatar"
                          id="previewImg" />
                        <label for="imageUpload"><i
                            class="fas fa-camera text-white"></i></label>
                        <input type="file"
                          id="imageUpload"
                          name="image"
                          accept="image/*" />
                      </div>
                    </div>

                    <!-- Name -->
                    <div class="form-group">
                      <label for="name">Full Name</label>
                      <input type="text"
                        class="form-control"
                        name="name"
                        id="name"
                        placeholder="Full Name" />
                    </div>

                    <!-- Email & Phone -->
                    <div class="form-row">
                      <div
                        class="form-group col-md-6">
                        <label for="email">Email</label>
                        <input type="email"
                          class="form-control"
                          name="email"
                          id="email"
                          placeholder="Email" />
                      </div>
                      <div
                        class="form-group col-md-6">
                        <label>Phone Number</label>
                        <input type="text"
                          class="form-control"
                          name="phone"
                          placeholder="Phone Number" />
                      </div>
                    </div>

                    <!-- Username -->
                    <div class="form-group">
                      <label for="username">Username</label>
                      <input type="text"
                        class="form-control"
                        name="username"
                        id="username"
                        placeholder="Username" />
                    </div>

                    <!-- Address -->
                    <div class="form-group">
                      <label>Address</label>
                      <textarea name="address"
                        class="form-control"
                        placeholder="Address"></textarea>
                    </div>

                    <!-- DOB & Gender -->
                    <div class="form-row">
                      <div
                        class="form-group col-md-6">
                        <label>Date of Birth</label>
                        <input type="date"
                          class="form-control"
                          name="dob"
                          placeholder="Date of Birth" />
                      </div>
                      <div
                        class="form-group col-md-6">
                        <label>Gender</label><br />
                        <div
                          class="form-check form-check-inline">
                          <input
                            class="form-check-input"
                            type="radio"
                            name="gender"
                            value="Male" checked />
                          <label
                            class="form-check-label">Male</label>
                        </div>
                        <div
                          class="form-check form-check-inline">
                          <input
                            class="form-check-input"
                            type="radio"
                            name="gender"
                            value="Female" />
                          <label
                            class="form-check-label">Female</label>
                        </div>
                      </div>
                    </div>

                    <!-- Hobby -->
                    <div class="form-group">
                      <label>Hobby</label><br />
                      <% const hobbiesList = [
                      "Singing", "Dancing", "Travelling", "Drawing",
                      "Gym", "Hike", "Gaming", "Sports", "Coding", "Other"
                      ]; %>

                      <% hobbiesList.forEach(h => { %>
                      <div class="form-check form-check-inline">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          name="hobby"
                          value="<%= h %>" />
                        <label class="form-check-label"><%= h %></label>
                      </div>
                      <% }); %>
                    </div>

                    <!-- Passwords -->
                    <div class="form-row">
                      <div
                        class="form-group col-md-6">
                        <label for="password">Password</label>
                        <div class="input-group">
                          <input type="password"
                            class="form-control"
                            name="password"
                            id="password"
                            placeholder="Password" />
                          <div
                            class="input-group-append">
                            <span
                              class="input-group-text"
                              style="cursor: pointer;"
                              onclick="togglePassword('password', 'eyeIcon1')">
                              <i id="eyeIcon1"
                                class="fa-solid fa-eye"></i>
                            </span>
                          </div>
                        </div>
                      </div>

                      <div
                        class="form-group col-md-6">
                        <label for="confirmPassword">Confirm
                          Password</label>
                        <div class="input-group">
                          <input type="password"
                            class="form-control"
                            name="confirmPassword"
                            id="confirmPassword"
                            placeholder="Retype Password" />
                          <div
                            class="input-group-append">
                            <span
                              class="input-group-text"
                              style="cursor: pointer;"
                              onclick="togglePassword('confirmPassword', 'eyeIcon2')">
                              <i id="eyeIcon2"
                                class="fa-solid fa-eye"></i>
                            </span>
                          </div>
                        </div>
                      </div>

                    </div>

                    <!-- Submit -->
                    <div
                      class="form-group text-center mt-4">
                      <button type="submit"
                        class="btn btn-success btn-lg w-100">Add
                        User</button>
                    </div>
                  </form>

                  <div class="text-center mt-2">
                    <a href="/manageuser"
                      class="text-muted">‚Üê Go Back</a>
                  </div>

                </div>

              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- Common Scripts -->
    <%- include('partials/scripts') %>

    <!-- ‚úÖ jQuery Validate -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>

    <script>
  // Custom pattern rule
  $.validator.addMethod("pattern", function (value, element, param) {
    if (this.optional(element)) return true;
    if (typeof param === "string") {
      param = new RegExp(param);
    }
    return param.test(value);
  }, "Invalid format.");

  $.validator.addMethod("genderValid", function(value, element) {
  if (value === "") {
    return true; // allow empty
  }
  return value === "Male" || value === "Female";
}, "Gender must be Male or Female");

$.validator.addMethod("isoDate", function(value, element) {
  if (value === "") {
    return true; // allow empty
  }
  // Simple regex for YYYY-MM-DD format
  return /^\d{4}-\d{2}-\d{2}$/.test(value);
}, "Please enter a valid date (YYYY-MM-DD)");


  $(function () {
    $("#adduser").validate({
      rules: {
        name: {
          required: true,
          pattern: "^[A-Za-z ]+$",
        },
        email: {
          required: true,
          email: true,
        },
        phone: {
          digits: true,
          minlength: 10,
          maxlength: 10,
        },
        address: {
          maxlength: 200,
        },
        username: {
          minlength: 4,
        },
        password: {
          required: true,
          minlength: 6,
          maxlength: 10,
          pattern: "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&]).+$",
        },
        confirmPassword: {
          required: true,
          equalTo: "#password",
        },
          gender: {
      genderValid: true
    },
    hobby: {
    },
    dob: {
      isoDate: true
    },
      },
      messages: {
        name: {
          required: "Name is required.",
          pattern: "Name must contain only letters.",
        },
        email: {
          required: "Email is required.",
          email: "Enter a valid email address.",
        },
        phone: {
          digits: "Only digits allowed.",
          maxlength: "Phone cannot exceed 10 digits.",
          minlength: "phone cannot less 10 digits.",
        },
        address: {
          maxlength: "Address must be less than 200 characters.",
        },
        username: {
          minlength: "Username must be at least 4 characters",
        },
        password: {
          required: "Password is required.",
          minlength: "Minimum 6 characters.",
          maxlength: "Maximum 10 characters.",
          pattern: "Include upper, lower, digit, and special character.",
        },
        confirmPassword: {
          required: "Please confirm your password.",
          equalTo: "Passwords do not match.",
        },
        gender: {
      genderValid: "Gender must be Male or Female"
    },
      dob: {
      isoDate: "Please enter a valid date in YYYY-MM-DD format"
    }
      },
      errorElement: "label",
      errorClass: "error",
      highlight: function (element) {
        $(element).addClass("is-invalid");
      },
      unhighlight: function (element) {
        $(element).removeClass("is-invalid");
      },
      errorPlacement: function (error, element) {
  if (element.attr("name") === "gender") {
    // Append error after the last radio button inside the same form-group
    element.closest('.form-group').find('.form-check').last().after(error);
  } else if (element.closest(".input-group").length > 0) {
    error.insertAfter(element.closest(".input-group"));
  } else {
    error.insertAfter(element);
  }
}
    });
  });

  $(function() {
  // Define the fields you want to target
  var requiredFields = ["name", "email", "username", "password", "confirmPassword"];

  requiredFields.forEach(function(fieldName) {
    var $field = $("#adduser").find("[name='" + fieldName + "']");
    var id = $field.attr("id");

    if (id) {
      // Create the asterisk span
      var $asterisk = $('<span class="required-star" style="color:red; margin-left:3px">*</span>');

      // Append it to the label
      $("label[for='" + id + "']").append($asterisk);

      // Show or hide based on initial value
      if ($field.val().trim() !== "") {
        $asterisk.hide();
      }

      // Listen to input changes
      $field.on("input change", function() {
        if ($field.val().trim() === "") {
          $asterisk.fadeIn();
        } else {
          $asterisk.fadeOut();
        }
      });
    }
  });
});

</script>

    <!-- ‚úÖ Validation Script -->
    <script src="/src/assets/js/authjs.js"></script>
    <script>
  // Image Preview
  document.getElementById("imageUpload").addEventListener("change", function (e) {
    const img = document.getElementById("previewImg");
    if (e.target.files && e.target.files[0]) {
      img.src = URL.createObjectURL(e.target.files[0]);
    }
  });

 document.addEventListener("DOMContentLoaded", function() {
    const errorDiv = document.getElementById("errorMsg");
    if (errorDiv) {
      setTimeout(() => {
        errorDiv.style.transition = "opacity 0.5s ease";
        errorDiv.style.opacity = "0";
        setTimeout(() => {
          errorDiv.style.display = "none";
        }, 500);
      }, 5000); 
    }
  });
</script>

  </body>
</html>
